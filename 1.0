--=========================================================
--  BeeSSshota UI
--  Вкладки: Автосбор / Игрок / Настройки
--  Сворачивание в кружок, спидхак, копия ТГ-ссылки
--=========================================================

---------------------- НАСТРОЙКИ --------------------------

local TELEGRAM_LINK = "https://t.me/BssShota" -- <=== ЗАМЕНИ НА СВОЮ ССЫЛКУ

---------------------- НАСТРОЙКИ ТОКЕНОВ ------------------

local TOKEN_TYPES = {
    Glitter     = { id = "2542899798", label = "Глиттер" },
    BlueBoost   = { id = "1442863423", label = "Синий буст" },
    PollenMark  = { id = "2499540966", label = "Метка пыльцы" },
    Focus       = { id = "1629649299", label = "Фокус" },
    Glue        = { id = "2504978518", label = "Клей" },
    Honey       = { id = "1472135114", label = "Мёд" },
    Bombs       = { id = "1442725244", label = "R/B/W бомбы" },
    HoneyMark   = { id = "2499514197", label = "Метка переработки мёда" },
}

local collectiblesName = "Collectibles"

---------------------- СЕРВИСЫ ----------------------------

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local lp = Players.LocalPlayer

-- для анти-АФК
local VirtualUser
pcall(function()
    VirtualUser = game:GetService("VirtualUser")
end)

---------------------- ХЕЛПЕРЫ ----------------------------

local function safeNotify(text)
    pcall(function()
        StarterGui:SetCore("SendNotification", {
            Title = "BeeSSshota",
            Text = text,
            Duration = 3
        })
    end)
end

local function copyToClipboard(text)
    if setclipboard then
        setclipboard(text)
    elseif toclipboard then
        toclipboard(text)
    else
        safeNotify("Клиент не поддерживает копирование :(")
        return
    end
    safeNotify("Ссылка скопирована")
end

---------------------- ВНЕШНИЕ КАРТИНКИ -------------------
-- Пытается скачать PNG с URL, сохранить в файл и получить asset через getcustomasset/getsynasset.
-- Если экзекутор этого не умеет, вернёт nil и скрипт просто покажет текстовый логотип.
local function loadExternalImage(url, localPath)
    if not (writefile and isfile and (getcustomasset or getsynasset)) then
        warn("[BeeSSshota] Экзекутор не поддерживает внешние картинки (нет writefile/isfile/getcustomasset)")
        return nil
    end

    local ok, data = pcall(function()
        return game:HttpGet(url)
    end)
    if not ok or not data then
        warn("[BeeSSshota] Не удалось скачать картинку: " .. tostring(data))
        return nil
    end

    localPath = localPath or "BeeSSshota_logo.png"

    -- Если файла ещё нет – создаём
    local okExists, exists = pcall(function()
        return isfile(localPath)
    end)
    if not (okExists and exists) then
        pcall(function()
            writefile(localPath, data)
        end)
    end

    local getter = getcustomasset or getsynasset
    local okAsset, asset = pcall(function()
        return getter(localPath)
    end)
    if not okAsset then
        warn("[BeeSSshota] Не удалось создать asset из файла: " .. tostring(asset))
        return nil
    end

    return asset
end

---------------------- ЛОГИКА ТЕЛЕПОРТА -------------------

local function getHRP()
    local char = lp.Character or lp.CharacterAdded:Wait()
    local hrp  = char:FindFirstChild("HumanoidRootPart") or char:WaitForChild("HumanoidRootPart")
    return hrp
end

local collectibles = workspace:FindFirstChild(collectiblesName)
if not collectibles then
    warn("[BeeSSshota] Не нашёл workspace." .. collectiblesName)
end

local function textureMatches(tex, idDigits)
    if not tex then return false end
    if tex == ("rbxassetid://" .. idDigits) then return true end
    if tex == idDigits then return true end
    if tex:match(idDigits) then return true end
    return false
end

local function getTokenType(token)
    if not token then return nil end

    local frontDecal
    if token:IsA("BasePart") then
        frontDecal = token:FindFirstChild("FrontDecal")
    elseif token:IsA("Model") then
        frontDecal = token:FindFirstChild("FrontDecal", true)
    end

    if not (frontDecal and frontDecal:IsA("Decal")) then
        return nil
    end

    local tex = frontDecal.Texture or ""
    for key, info in pairs(TOKEN_TYPES) do
        if textureMatches(tex, info.id) then
            return key
        end
    end

    return nil
end

local function teleportToToken(token, tokenType)
    local hrp = getHRP()
    if not hrp then return end

    local targetPart
    if token:IsA("BasePart") then
        targetPart = token
    elseif token:IsA("Model") then
        targetPart = token.PrimaryPart or token:FindFirstChildWhichIsA("BasePart", true)
    end

    if targetPart then
        hrp.CFrame = targetPart.CFrame + Vector3.new(0, 4, 0)
        print(string.format("[BeeSSshota] TP к токену (%s): %s",
            tokenType or "?", targetPart:GetFullName()))
    else
        warn("[BeeSSshota] Не нашёл Part внутри токена")
    end
end

---------------------- СОСТОЯНИЕ АВТОСБОРА ----------------

local enabledTypes = {}
for key in pairs(TOKEN_TYPES) do
    enabledTypes[key] = false
end

local connChildAdded = nil

local function anyTypeEnabled()
    for _, v in pairs(enabledTypes) do
        if v then return true end
    end
    return false
end

local function ensureCollectibles()
    if collectibles and collectibles.Parent then return true end
    collectibles = workspace:FindFirstChild(collectiblesName)
    if not collectibles then
        warn("[BeeSSshota] Нет папки " .. collectiblesName)
        return false
    end
    return true
end

local function disconnectListener()
    if connChildAdded then
        connChildAdded:Disconnect()
        connChildAdded = nil
    end
end

local function connectListener()
    if connChildAdded or not ensureCollectibles() then return end

    connChildAdded = collectibles.ChildAdded:Connect(function(child)
        task.wait(0.1)
        if not anyTypeEnabled() then return end

        local tType = getTokenType(child)
        if tType and enabledTypes[tType] then
            teleportToToken(child, tType)
        end
    end)
end

local function setTypeEnabled(tokenKey, on)
    enabledTypes[tokenKey] = on and true or false

    if anyTypeEnabled() then
        -- Подписываемся на появление НОВЫХ токенов
        connectListener()
        -- ВАЖНО: больше НЕ сканируем уже существующие токены,
        -- чтобы не тпшиться к одноразовым / старым токенам.
    else
        disconnectListener()
    end
end

---------------------- СПИДХАК ---------------------------

local currentHumanoid = nil
local baseWalkSpeed = 16      -- базовая скорость персонажа
local speedValue = 0          -- значение слайдера (0..90)
local speedEnabled = false    -- включён ли спидхак
local walkConn = nil          -- подписка на изменения WalkSpeed

-- Применяем нашу скорость / обновляем базовую
local function applySpeed()
    if not currentHumanoid then return end

    if speedEnabled then
        -- когда спидхак включён – всегда держим base + slider
        currentHumanoid.WalkSpeed = baseWalkSpeed + speedValue
    else
        -- когда спидхак выключен – считаем текущее значение новой базой
        baseWalkSpeed = currentHumanoid.WalkSpeed
    end
end

-- Подписываемся на Humanoid и его WalkSpeed
local function hookHumanoid(hum)
    if walkConn then
        walkConn:Disconnect()
        walkConn = nil
    end

    currentHumanoid = hum

    if hum then
        -- при появлении персонажа запоминаем его текущую базовую скорость
        baseWalkSpeed = hum.WalkSpeed

        -- если спидхак уже был включён – сразу применяем
        if speedEnabled then
            hum.WalkSpeed = baseWalkSpeed + speedValue
        end

        -- следим за ЛЮБЫМИ изменениями WalkSpeed (токены, эффекты и т.п.)
        walkConn = hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
            if currentHumanoid ~= hum then return end
            applySpeed()
        end)
    end
end

local function updateHumanoidRef()
    local char = lp.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    hookHumanoid(hum)
end

updateHumanoidRef()
lp.CharacterAdded:Connect(function()
    task.wait(1)
    updateHumanoidRef()
end)

---------------------- АНТИ-АФК ---------------------------
local antiAfkEnabled = false
local antiAfkConn = nil

local function setAntiAfk(on)
    on = on and true or false
    antiAfkEnabled = on

    if antiAfkConn then
        antiAfkConn:Disconnect()
        antiAfkConn = nil
    end

    if antiAfkEnabled and lp and VirtualUser then
        antiAfkConn = lp.Idled:Connect(function()
            if not antiAfkEnabled then return end
            pcall(function()
                VirtualUser:Button2Down(Vector2.new(0, 0), workspace.CurrentCamera and workspace.CurrentCamera.CFrame or CFrame.new())
                task.wait(0.1)
                VirtualUser:Button2Up(Vector2.new(0, 0), workspace.CurrentCamera and workspace.CurrentCamera.CFrame or CFrame.new())
            end)
        end)
    end
end

-------------------------- UI БАЗА ------------------------

pcall(function()
    local cg = game:GetService("CoreGui")
    local old = cg:FindFirstChild("BeeSSshota_UI")
    if old then old:Destroy() end
    if gethui then
        local h = gethui()
        local old2 = h:FindFirstChild("BeeSSshota_UI")
        if old2 then old2:Destroy() end
    end
end)

local parentGui
do
    local ok, res = pcall(function()
        if gethui then
            return gethui()
        else
            return game:GetService("CoreGui")
        end
    end)
    parentGui = ok and res or game:GetService("CoreGui")
end

local function create(className, props, parent)
    local o = Instance.new(className)
    for k, v in pairs(props or {}) do
        o[k] = v
    end
    if parent then o.Parent = parent end
    return o
end

local gui = create("ScreenGui", {
    Name = "BeeSSshota_UI",
    ResetOnSpawn = false,
    IgnoreGuiInset = true,
}, parentGui)

local MAIN_W, MAIN_H = 620, 340

local shadow = create("ImageLabel", {
    Name = "Shadow",
    Size = UDim2.new(0, MAIN_W + 40, 0, MAIN_H + 40),
    Position = UDim2.new(0.5, -(MAIN_W + 40)/2, 0.5, -(MAIN_H + 40)/2),
    BackgroundTransparency = 1,
    Image = "rbxassetid://1316045217",
    ImageColor3 = Color3.fromRGB(0, 0, 0),
    ImageTransparency = 0.55,
    ScaleType = Enum.ScaleType.Slice,
    SliceCenter = Rect.new(10, 10, 118, 118),
}, gui)

local mainFrame = create("Frame", {
    Name = "MainFrame",
    Size = UDim2.new(0, MAIN_W, 0, MAIN_H),
    Position = UDim2.new(0.5, -MAIN_W/2, 0.5, -MAIN_H/2),
    BackgroundColor3 = Color3.fromRGB(10, 12, 24),
    BorderSizePixel = 0,
}, gui)

create("UICorner", { CornerRadius = UDim.new(0, 16) }, mainFrame)
create("UIStroke", {
    Thickness = 2,
    Color = Color3.fromRGB(90, 120, 220),
    Transparency = 0.2,
}, mainFrame)

create("UIGradient", {
    Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(22, 26, 60)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(6, 8, 20)),
    }),
    Rotation = 45,
}, mainFrame)

local function updateShadow()
    shadow.Position = mainFrame.Position + UDim2.new(0, -20, 0, -20)
    shadow.Size     = UDim2.new(0, mainFrame.Size.X.Offset + 40, 0, mainFrame.Size.Y.Offset + 40)
end
updateShadow()

---------------------- ЛЕВАЯ ПАНЕЛЬ -----------------------
local sidebar = create("Frame", {
    Size = UDim2.new(0, 150, 1, 0),
    BackgroundColor3 = Color3.fromRGB(8, 10, 20),
    BorderSizePixel = 0,
}, mainFrame)
create("UICorner", { CornerRadius = UDim.new(0, 16) }, sidebar)

-- Контейнер под логотип
local logoContainer = create("Frame", {
    Size = UDim2.new(1, 0, 0, 40),
    Position = UDim2.new(0, 0, 0, 4),
    BackgroundTransparency = 1,
}, sidebar)

-- Круглая “рамка” логотипа
local logoCircle = create("Frame", {
    Size = UDim2.new(0, 28, 0, 28),
    Position = UDim2.new(0, 10, 0, 6),
    BackgroundTransparency = 1, -- ← фон убран
    BorderSizePixel = 0,
}, logoContainer)
create("UICorner", { CornerRadius = UDim.new(1, 0) }, logoCircle)

-- Пытаемся загрузить PNG с GitHub
-- СЮДА вставь ссылку на свой logo.png в репозитории BeeSSshota
local LOGO_URL = "https://raw.githubusercontent.com/igroman33igrok/BeeSSshota/refs/heads/main/logo.png"
local logoAssetId = loadExternalImage(LOGO_URL, "BeeSSshota_logo.png")

if logoAssetId then
    -- Настоящая картинка
    local logoImage = create("ImageLabel", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Image = logoAssetId,
    }, logoCircle)
else
    -- Если картинку не получилось загрузить — делаем текстовый логотип внутри круга
    local logoInner = create("Frame", {
        Size = UDim2.new(1, -6, 1, -6),
        Position = UDim2.new(0, 3, 0, 3),
        BackgroundColor3 = Color3.fromRGB(16, 18, 30),
        BorderSizePixel = 0,
    }, logoCircle)
    create("UICorner", { CornerRadius = UDim.new(1, 0) }, logoInner)

    local logoText = create("TextLabel", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.GothamBold,
        Text = "BS",
        TextSize = 14,
        TextColor3 = Color3.fromRGB(230, 235, 255),
    }, logoInner)
end

-- Текст "BeeSSshota" справа от логотипа
local logoTextLabel = create("TextLabel", {
    Size = UDim2.new(1, -50, 0, 24),
    Position = UDim2.new(0, 50, 0, 8),
    BackgroundTransparency = 1,
    Font = Enum.Font.GothamBold,
    Text = "BeeSSshota",
    TextSize = 16,
    TextColor3 = Color3.fromRGB(200, 210, 255),
    TextXAlignment = Enum.TextXAlignment.Left,
}, logoContainer)

local sidebarButtonsFrame = create("Frame", {
    Size = UDim2.new(1, 0, 1, -50),
    Position = UDim2.new(0, 0, 0, 50),
    BackgroundTransparency = 1,
}, sidebar)

local sideList = create("UIListLayout", {
    Padding = UDim.new(0, 6),
    FillDirection = Enum.FillDirection.Vertical,
    HorizontalAlignment = Enum.HorizontalAlignment.Center,
    VerticalAlignment = Enum.VerticalAlignment.Top,
}, sidebarButtonsFrame)

local MAIN_TABS = {
    { key = "autos",     label = "Автосбор"   },
    { key = "player",    label = "Игрок"      },
    { key = "settings",  label = "Настройки"  },
}

local currentMainTab = "autos"
local sidebarButtons = {}

local function setMainTabVisual()
    for key, btn in pairs(sidebarButtons) do
        local selected = (key == currentMainTab)
        local goalColor = selected and Color3.fromRGB(70, 120, 255) or Color3.fromRGB(26, 30, 60)
        local goalText  = selected and Color3.fromRGB(235, 240, 255) or Color3.fromRGB(185, 190, 220)

        btn.BackgroundColor3 = goalColor
        btn.Label.TextColor3 = goalText
    end
end

for _, info in ipairs(MAIN_TABS) do
    local btn = create("TextButton", {
        Size = UDim2.new(1, -30, 0, 30),
        BackgroundColor3 = Color3.fromRGB(26, 30, 60),
        BorderSizePixel = 0,
        Text = "",
        AutoButtonColor = false,
    }, sidebarButtonsFrame)
    create("UICorner", { CornerRadius = UDim.new(0, 10) }, btn)

    local lbl = create("TextLabel", {
        Name = "Label",
        Size = UDim2.new(1, -10, 1, 0),
        Position = UDim2.new(0, 10, 0, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.Gotham,
        Text = info.label,
        TextSize = 14,
        TextColor3 = Color3.fromRGB(185, 190, 220),
        TextXAlignment = Enum.TextXAlignment.Left,
    }, btn)

    sidebarButtons[info.key] = btn

    btn.MouseEnter:Connect(function()
        if currentMainTab == info.key then return end
        TweenService:Create(btn, TweenInfo.new(0.12, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
            BackgroundColor3 = Color3.fromRGB(40, 50, 90)
        }):Play()
    end)

    btn.MouseLeave:Connect(function()
        setMainTabVisual()
    end)

    btn.MouseButton1Click:Connect(function()
        currentMainTab = info.key
        setMainTabVisual()
    end)
end

setMainTabVisual()

---------------------- ВЕРХНЯЯ ПАНЕЛЬ ---------------------

local topBar = create("Frame", {
    Size = UDim2.new(1, -150, 0, 40),
    Position = UDim2.new(0, 150, 0, 0),
    BackgroundColor3 = Color3.fromRGB(14, 16, 30),
    BorderSizePixel = 0,
}, mainFrame)

local topTitle = create("TextLabel", {
    Size = UDim2.new(1, -100, 1, 0),
    Position = UDim2.new(0, 10, 0, 0),
    BackgroundTransparency = 1,
    Font = Enum.Font.GothamBold,
    Text = "Меню",
    TextSize = 16,
    TextColor3 = Color3.fromRGB(200, 210, 255),
    TextXAlignment = Enum.TextXAlignment.Left,
}, topBar)

local collapseBtn = create("TextButton", {
    Size = UDim2.new(0, 26, 0, 22),
    Position = UDim2.new(1, -60, 0.5, -11),
    BackgroundColor3 = Color3.fromRGB(40, 45, 70),
    BorderSizePixel = 0,
    Text = "▾",
    Font = Enum.Font.GothamBold,
    TextSize = 14,
    TextColor3 = Color3.fromRGB(220, 225, 245),
    AutoButtonColor = false,
}, topBar)
create("UICorner", { CornerRadius = UDim.new(0, 8) }, collapseBtn)

local closeBtn = create("TextButton", {
    Size = UDim2.new(0, 26, 0, 22),
    Position = UDim2.new(1, -30, 0.5, -11),
    BackgroundColor3 = Color3.fromRGB(70, 40, 48),
    BorderSizePixel = 0,
    Text = "X",
    Font = Enum.Font.GothamBold,
    TextSize = 14,
    TextColor3 = Color3.fromRGB(255, 215, 225),
    AutoButtonColor = false,
}, topBar)
create("UICorner", { CornerRadius = UDim.new(0, 8) }, closeBtn)

closeBtn.MouseButton1Click:Connect(function()
    disconnectListener()
    setAntiAfk(false)
    gui:Destroy()
end)

-- ================== СВЁРНУТОЕ КРУГЛОЕ МЕНЮ ==================

local isMinimized = false

-- Кружок, который остаётся на экране после сворачивания
local minCircle = create("TextButton", {
    Name = "BeeSSshota_MiniCircle",
    Size = UDim2.new(0, 46, 0, 46),
    Position = UDim2.new(0, 20, 0.5, -23),
    BackgroundColor3 = Color3.fromRGB(20, 24, 50),
    BorderSizePixel = 0,
    Text = "BS",
    Font = Enum.Font.GothamBold,
    TextSize = 16,
    TextColor3 = Color3.fromRGB(230, 235, 255),
    AutoButtonColor = false,
    Visible = false, -- изначально кружок скрыт, видно только основное окно
    Active = true,   -- важно для тача
}, gui)

create("UICorner", {
    CornerRadius = UDim.new(1, 0)
}, minCircle)

create("UIStroke", {
    Thickness = 2,
    Color = Color3.fromRGB(90, 120, 220),
    Transparency = 0.2
}, minCircle)

-- Функции показать/спрятать основное окно
local function showMain()
    isMinimized = false
    mainFrame.Visible = true
    shadow.Visible = true
    minCircle.Visible = false
end

local function hideMain()
    isMinimized = true
    mainFrame.Visible = false
    shadow.Visible = false
    minCircle.Visible = true
end

-- Кнопка "стрелочка" сворачивает/разворачивает
collapseBtn.MouseButton1Click:Connect(function()
    if isMinimized then
        showMain()
    else
        hideMain()
    end
end)

-- Нажатие по кружку (один тап) — разворачивает
minCircle.MouseButton1Click:Connect(function()
    if isMinimized then
        showMain()
    end
end)

-- ============ ПЕРЕТАСКИВАНИЕ КРУЖКА (МЫШЬ + ТЕЛЕФОН) ============

local dragging = false
local dragInput
local dragStart
local startPos

local function updateMiniCircle(input)
    local delta = input.Position - dragStart
    minCircle.Position = UDim2.new(
        startPos.X.Scale,
        startPos.X.Offset + delta.X,
        startPos.Y.Scale,
        startPos.Y.Offset + delta.Y
    )
end

minCircle.InputBegan:Connect(function(input)
    -- Срабатывает и на ПК (MouseButton1), и на телефоне (Touch)
    if input.UserInputType == Enum.UserInputType.MouseButton1
        or input.UserInputType == Enum.UserInputType.Touch then

        dragging = true
        dragStart = input.Position
        startPos = minCircle.Position

        -- Когда палец/мышь отпущены — прекращаем перетаскивание
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

UIS.InputChanged:Connect(function(input)
    if not dragging then return end

    -- Двигаем и при движении мыши, и при движении пальца
    if input.UserInputType == Enum.UserInputType.MouseMovement
        or input.UserInputType == Enum.UserInputType.Touch then

        updateMiniCircle(input)
    end
end)
-- ================== КОНЕЦ БЛОКА КРУЖКА ==================

---------------------- ПРАВАЯ ОБЛАСТЬ ---------------------

local contentFrame = create("Frame", {
    Size = UDim2.new(1, -150, 1, -40),
    Position = UDim2.new(0, 150, 0, 40),
    BackgroundTransparency = 1,
}, mainFrame)

-- ПАНЕЛЬ: АВТОСБОР / ТОКЕНЫ
local autosPanel = create("Frame", {
    Size = UDim2.new(1, -20, 1, -20),
    Position = UDim2.new(0, 10, 0, 10),
    BackgroundColor3 = Color3.fromRGB(14, 16, 32),
    BorderSizePixel = 0,
}, contentFrame)
create("UICorner", { CornerRadius = UDim.new(0, 12) }, autosPanel)

local autosTitle = create("TextLabel", {
    Size = UDim2.new(1, -20, 0, 24),
    Position = UDim2.new(0, 10, 0, 6),
    BackgroundTransparency = 1,
    Font = Enum.Font.GothamBold,
    Text = "Автосбор токенов",
    TextSize = 16,
    TextColor3 = Color3.fromRGB(220, 225, 255),
    TextXAlignment = Enum.TextXAlignment.Left,
}, autosPanel)

local autosSub = create("TextLabel", {
    Size = UDim2.new(1, -20, 0, 34),
    Position = UDim2.new(0, 10, 0, 26),
    BackgroundTransparency = 1,
    Font = Enum.Font.Gotham,
    Text = "Включи токены, к которым нужно телепортироваться\nпри появлении на карте.",
    TextSize = 12,
    TextColor3 = Color3.fromRGB(160, 165, 210),
    TextXAlignment = Enum.TextXAlignment.Left,
    TextYAlignment = Enum.TextYAlignment.Top,
}, autosPanel)

local listHolder = create("Frame", {
    Size = UDim2.new(1, -20, 1, -70),
    Position = UDim2.new(0, 10, 0, 50),
    BackgroundTransparency = 1,
}, autosPanel)

local scroll = create("ScrollingFrame", {
    Size = UDim2.new(1, 0, 1, 0),
    CanvasSize = UDim2.new(0, 0, 0, 0),
    ScrollBarThickness = 4,
    BackgroundTransparency = 1,
    BorderSizePixel = 0,
}, listHolder)

local listLayout2 = create("UIListLayout", {
    Padding = UDim.new(0, 6),
    FillDirection = Enum.FillDirection.Vertical,
    HorizontalAlignment = Enum.HorizontalAlignment.Left,
    VerticalAlignment = Enum.VerticalAlignment.Top,
}, scroll)

listLayout2:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    scroll.CanvasSize = UDim2.new(0, 0, 0, listLayout2.AbsoluteContentSize.Y)
end)

local statusLabel = create("TextLabel", {
    Size = UDim2.new(1, -20, 0, 18),
    Position = UDim2.new(0, 10, 1, -22),
    BackgroundTransparency = 1,
    Font = Enum.Font.Gotham,
    Text = "Активно типов: 0",
    TextSize = 12,
    TextColor3 = Color3.fromRGB(200, 205, 235),
    TextXAlignment = Enum.TextXAlignment.Left,
}, autosPanel)

local function updateStatusLabel()
    local n = 0
    for _, v in pairs(enabledTypes) do
        if v then n = n + 1 end
    end
    statusLabel.Text = "Активно типов: " .. tostring(n)
end

for key, info in pairs(TOKEN_TYPES) do
    local row = create("Frame", {
        Size = UDim2.new(1, 0, 0, 26),
        BackgroundTransparency = 1,
    }, scroll)

    create("TextLabel", {
        Size = UDim2.new(1, -130, 1, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.Gotham,
        Text = info.label,
        TextSize = 13,
        TextColor3 = Color3.fromRGB(225, 228, 250),
        TextXAlignment = Enum.TextXAlignment.Left,
    }, row)

    local toggleBtn = create("TextButton", {
        Size = UDim2.new(0, 80, 0, 22),
        Position = UDim2.new(1, -84, 0.5, -11),
        BackgroundTransparency = 1,
        BorderSizePixel = 0,
        AutoButtonColor = false,
        Text = "",
    }, row)

    local track = create("Frame", {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Color3.fromRGB(60, 70, 100),
        BorderSizePixel = 0,
    }, toggleBtn)
    create("UICorner", { CornerRadius = UDim.new(1, 0) }, track)

    local knob = create("Frame", {
        Size = UDim2.new(0, 18, 1, -4),
        Position = UDim2.new(0, 3, 0, 2),
        BackgroundColor3 = Color3.fromRGB(235, 238, 255),
        BorderSizePixel = 0,
    }, track)
    create("UICorner", { CornerRadius = UDim.new(1, 0) }, knob)

    local on = false

    local function setVisual(immediate)
        local goalTrackColor = on and Color3.fromRGB(90, 180, 120) or Color3.fromRGB(60, 70, 100)
        local goalKnobPos    = on and UDim2.new(1, -21, 0, 2)      or UDim2.new(0, 3, 0, 2)

        if immediate then
            track.BackgroundColor3 = goalTrackColor
            knob.Position          = goalKnobPos
        else
            local ti = TweenInfo.new(0.18, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
            TweenService:Create(track, ti, {BackgroundColor3 = goalTrackColor}):Play()
            TweenService:Create(knob,  ti, {Position = goalKnobPos}):Play()
        end
    end

    setVisual(true)

    toggleBtn.MouseEnter:Connect(function()
        local ti = TweenInfo.new(0.12, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
        local col = on and Color3.fromRGB(105, 195, 140) or Color3.fromRGB(80, 90, 120)
        TweenService:Create(track, ti, {BackgroundColor3 = col}):Play()
    end)

    toggleBtn.MouseLeave:Connect(function()
        setVisual(false)
    end)

    toggleBtn.MouseButton1Down:Connect(function()
        local ti = TweenInfo.new(0.08, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
        TweenService:Create(knob, ti, {Size = UDim2.new(0, 16, 1, -6)}):Play()
    end)

    toggleBtn.MouseButton1Up:Connect(function()
        local ti = TweenInfo.new(0.08, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
        TweenService:Create(knob, ti, {Size = UDim2.new(0, 18, 1, -4)}):Play()
    end)

    toggleBtn.MouseButton1Click:Connect(function()
        on = not on
        setTypeEnabled(key, on)
        setVisual(false)
        updateStatusLabel()
    end)
end

updateStatusLabel()

----------------- ПАНЕЛЬ: ИГРОК (СПИДХАК) ---------------

-- ПАНЕЛЬ: ИГРОК
local playerPanel = create("Frame", {
    Size = UDim2.new(1, -20, 1, -20),
    Position = UDim2.new(0, 10, 0, 10),
    BackgroundColor3 = Color3.fromRGB(14, 16, 32),
    BorderSizePixel = 0,
    Visible = false,
}, contentFrame)
create("UICorner", { CornerRadius = UDim.new(0, 12) }, playerPanel)

local playerTitle = create("TextLabel", {
    Size = UDim2.new(1, -20, 0, 24),
    Position = UDim2.new(0, 10, 0, 6),
    BackgroundTransparency = 1,
    Font = Enum.Font.GothamBold,
    Text = "Игрок",
    TextSize = 16,
    TextColor3 = Color3.fromRGB(220, 225, 255),
    TextXAlignment = Enum.TextXAlignment.Left,
}, playerPanel)

local playerSub = create("TextLabel", {
    Size = UDim2.new(1, -20, 0, 36),
    Position = UDim2.new(0, 10, 0, 26),
    BackgroundTransparency = 1,
    Font = Enum.Font.Gotham,
    Text = "Настройка скорости передвижения.\n0 = стандартная скорость персонажа.",
    TextSize = 12,
    TextColor3 = Color3.fromRGB(160, 165, 210),
    TextXAlignment = Enum.TextXAlignment.Left,
    TextYAlignment = Enum.TextYAlignment.Top,
}, playerPanel)

-- === СПИДХАК СЛАЙДЕР ===
local maxSpeed = 90  -- максимум на слайдере

local speedRow = create("Frame", {
    Size = UDim2.new(1, -20, 0, 50),
    Position = UDim2.new(0, 10, 0, 70),
    BackgroundTransparency = 1,
}, playerPanel)

local speedLabel = create("TextLabel", {
    Size = UDim2.new(1, 0, 0, 18),
    Position = UDim2.new(0, 0, 0, 0),
    BackgroundTransparency = 1,
    Font = Enum.Font.Gotham,
    Text = "Спидхак",
    TextSize = 14,
    TextColor3 = Color3.fromRGB(220, 225, 255),
    TextXAlignment = Enum.TextXAlignment.Left,
}, speedRow)

local speedValueLabel = create("TextLabel", {
    Size = UDim2.new(0, 60, 0, 18),
    Position = UDim2.new(1, -60, 0, 0),
    BackgroundTransparency = 1,
    Font = Enum.Font.GothamBold,
    Text = tostring(speedValue), -- ВАЖНО: используем ГЛОБАЛЬНОЕ значение
    TextSize = 14,
    TextColor3 = Color3.fromRGB(200, 210, 255),
    TextXAlignment = Enum.TextXAlignment.Right,
}, speedRow)

local speedTrack = create("Frame", {
    Size = UDim2.new(1, -10, 0, 6),
    Position = UDim2.new(0, 0, 0, 26),
    BackgroundColor3 = Color3.fromRGB(45, 50, 80),
    BorderSizePixel = 0,
}, speedRow)
create("UICorner", { CornerRadius = UDim.new(0, 3) }, speedTrack)

local speedFill = create("Frame", {
    Size = UDim2.new(0, 0, 1, 0),
    BackgroundColor3 = Color3.fromRGB(120, 160, 255),
    BorderSizePixel = 0,
}, speedTrack)
create("UICorner", { CornerRadius = UDim.new(0, 3) }, speedFill)

local speedKnob = create("Frame", {
    Size = UDim2.new(0, 12, 0, 12),
    Position = UDim2.new(0, -6, 0.5, -6),
    BackgroundColor3 = Color3.fromRGB(230, 235, 255),
    BorderSizePixel = 0,
}, speedTrack)
create("UICorner", { CornerRadius = UDim.new(1, 0) }, speedKnob)

local draggingSpeed = false

local function setSpeedVisual(immediate)
    -- нормализуем значение 0..1
    local alpha = math.clamp(speedValue / maxSpeed, 0, 1)
    local trackSize = speedTrack.AbsoluteSize.X
    local trackPos = speedTrack.AbsolutePosition.X

    -- позиция ручки
    local knobX = alpha
    local goalKnobPos = UDim2.new(knobX, -6, 0.5, -6)
    local goalFillSize = UDim2.new(alpha, 0, 1, 0)

    speedValueLabel.Text = tostring(speedValue)

    if immediate then
        speedKnob.Position = goalKnobPos
        speedFill.Size = goalFillSize
    else
        local ti = TweenInfo.new(0.12, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
        TweenService:Create(speedKnob, ti, { Position = goalKnobPos }):Play()
        TweenService:Create(speedFill, ti, { Size = goalFillSize }):Play()
    end
end

-- Инициализируем визуал на основе ТЕКУЩЕГО значения speedValue
setSpeedVisual(true)

local function updateSpeedFromX(x)
    local absPos = speedTrack.AbsolutePosition
    local absSize = speedTrack.AbsoluteSize
    local rel = (x - absPos.X) / math.max(absSize.X, 1)
    rel = math.clamp(rel, 0, 1)

    speedValue = math.floor(rel * maxSpeed + 0.5)
    speedEnabled = (speedValue ~= 0)
    setSpeedVisual(false)
    applySpeed()
end

speedTrack.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSpeed = true
        updateSpeedFromX(input.Position.X)
    end
end)

speedKnob.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSpeed = true
    end
end)

UIS.InputChanged:Connect(function(input)
    if draggingSpeed and input.UserInputType == Enum.UserInputType.MouseMovement then
        updateSpeedFromX(input.Position.X)
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingSpeed = false
    end
end)

---------------- ПАНЕЛЬ: НАСТРОЙКИ ------------------

local settingsPanel = create("Frame", {
    Size = UDim2.new(1, -20, 1, -20),
    Position = UDim2.new(0, 10, 0, 10),
    BackgroundColor3 = Color3.fromRGB(14, 16, 32),
    BorderSizePixel = 0,
    Visible = false,
}, contentFrame)
create("UICorner", { CornerRadius = UDim.new(0, 12) }, settingsPanel)

local settingsTitle = create("TextLabel", {
    Size = UDim2.new(1, -20, 0, 24),
    Position = UDim2.new(0, 10, 0, 6),
    BackgroundTransparency = 1,
    Font = Enum.Font.GothamBold,
    Text = "Настройки",
    TextSize = 16,
    TextColor3 = Color3.fromRGB(220, 225, 255),
    TextXAlignment = Enum.TextXAlignment.Left,
}, settingsPanel)

local settingsSub = create("TextLabel", {
    Size = UDim2.new(1, -20, 0, 36),
    Position = UDim2.new(0, 10, 0, 26),
    BackgroundTransparency = 1,
    Font = Enum.Font.Gotham,
    Text = "Кнопка ниже скопирует ссылку на Telegram-канал скрипта.",
    TextSize = 12,
    TextColor3 = Color3.fromRGB(160, 165, 210),
    TextXAlignment = Enum.TextXAlignment.Left,
    TextYAlignment = Enum.TextYAlignment.Top,
}, settingsPanel)

-- Кнопка "Скопировать ссылку"
local copyBtn = create("TextButton", {
    Size = UDim2.new(0, 260, 0, 30),
    Position = UDim2.new(0, 10, 0, 70),
    BackgroundColor3 = Color3.fromRGB(70, 120, 255),
    BorderSizePixel = 0,
    Text = "Скопировать ссылку на канал",
    Font = Enum.Font.GothamBold,
    TextSize = 13,
    TextColor3 = Color3.fromRGB(240, 245, 255),
    AutoButtonColor = false,
}, settingsPanel)
create("UICorner", { CornerRadius = UDim.new(0, 8) }, copyBtn)

copyBtn.MouseButton1Click:Connect(function()
    copyToClipboard(TELEGRAM_LINK)
end)

----------------- Блок "Анти-АФК" ------------------

local antiAfkLabel = create("TextLabel", {
    Size = UDim2.new(1, -20, 0, 20),
    Position = UDim2.new(0, 10, 0, 110),
    BackgroundTransparency = 1,
    Font = Enum.Font.Gotham,
    Text = "Анти-АФК",
    TextSize = 13,
    TextColor3 = Color3.fromRGB(220, 225, 255),
    TextXAlignment = Enum.TextXAlignment.Left,
}, settingsPanel)

local antiAfkRow = create("Frame", {
    Size = UDim2.new(0, 160, 0, 26),
    Position = UDim2.new(0, 10, 0, 135),
    BackgroundTransparency = 1,
}, settingsPanel)

local antiAfkToggleBtn = create("TextButton", {
    Size = UDim2.new(0, 80, 0, 22),
    Position = UDim2.new(0, 0, 0, 2),
    BackgroundTransparency = 1,
    BorderSizePixel = 0,
    AutoButtonColor = false,
    Text = "",
}, antiAfkRow)

local antiAfkTrack = create("Frame", {
    Size = UDim2.new(1, 0, 1, 0),
    BackgroundColor3 = Color3.fromRGB(60, 70, 100),
    BorderSizePixel = 0,
}, antiAfkToggleBtn)
create("UICorner", { CornerRadius = UDim.new(1, 0) }, antiAfkTrack)

local antiAfkKnob = create("Frame", {
    Size = UDim2.new(0, 18, 1, -4),
    Position = UDim2.new(0, 3, 0, 2),
    BackgroundColor3 = Color3.fromRGB(235, 238, 255),
    BorderSizePixel = 0,
}, antiAfkTrack)
create("UICorner", { CornerRadius = UDim.new(1, 0) }, antiAfkKnob)

local antiAfkOn = false

local function setAntiAfkVisual(immediate)
    local goalTrackColor = antiAfkOn and Color3.fromRGB(90, 180, 120) or Color3.fromRGB(60, 70, 100)
    local goalKnobPos = antiAfkOn and UDim2.new(1, -21, 0, 2) or UDim2.new(0, 3, 0, 2)

    if immediate then
        antiAfkTrack.BackgroundColor3 = goalTrackColor
        antiAfkKnob.Position = goalKnobPos
    else
        local ti = TweenInfo.new(0.18, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
        TweenService:Create(antiAfkTrack, ti, { BackgroundColor3 = goalTrackColor }):Play()
        TweenService:Create(antiAfkKnob, ti, { Position = goalKnobPos }):Play()
    end
end

setAntiAfkVisual(true)

antiAfkToggleBtn.MouseEnter:Connect(function()
    local ti = TweenInfo.new(0.12, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
    local col = antiAfkOn and Color3.fromRGB(105, 195, 140) or Color3.fromRGB(80, 90, 120)
    TweenService:Create(antiAfkTrack, ti, { BackgroundColor3 = col }):Play()
end)

antiAfkToggleBtn.MouseLeave:Connect(function()
    setAntiAfkVisual(false)
end)

antiAfkToggleBtn.MouseButton1Down:Connect(function()
    local ti = TweenInfo.new(0.08, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
    TweenService:Create(antiAfkKnob, ti, { Size = UDim2.new(0, 16, 1, -6) }):Play()
end)

antiAfkToggleBtn.MouseButton1Up:Connect(function()
    local ti = TweenInfo.new(0.08, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
    TweenService:Create(antiAfkKnob, ti, { Size = UDim2.new(0, 18, 1, -4) }):Play()
end)

antiAfkToggleBtn.MouseButton1Click:Connect(function()
    antiAfkOn = not antiAfkOn
    setAntiAfk(antiAfkOn)
    setAntiAfkVisual(false)
end)

---------------------- ПЕРЕКЛЮЧЕНИЕ ПАНЕЛЕЙ ---------------

local function updatePanelsVisibility()
    autosPanel.Visible    = (currentMainTab == "autos")
    playerPanel.Visible   = (currentMainTab == "player")
    settingsPanel.Visible = (currentMainTab == "settings")
end

updatePanelsVisibility()

for key, btn in pairs(sidebarButtons) do
    btn.MouseButton1Click:Connect(function()
        currentMainTab = key
        setMainTabVisual()
        updatePanelsVisibility()
    end)
end

---------------------- ПЕРЕТАСКИВАНИЕ ОКНА ----------------

local draggingMain = false
local dragStart, startPos
local lastWindowPos = mainFrame.Position

mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1
        and input.Position.Y < mainFrame.AbsolutePosition.Y + 40 then
        draggingMain  = true
        dragStart     = input.Position
        startPos      = mainFrame.Position
    end
end)

mainFrame.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        draggingMain = false
        lastWindowPos = mainFrame.Position
    end
end)

UIS.InputChanged:Connect(function(input)
    if draggingMain and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
        lastWindowPos = mainFrame.Position
        updateShadow()
    end
end)

print("[BeeSSshota] UI загружен: Автосбор, Игрок (спидхак), Настройки, сворачивание в кружок.")
